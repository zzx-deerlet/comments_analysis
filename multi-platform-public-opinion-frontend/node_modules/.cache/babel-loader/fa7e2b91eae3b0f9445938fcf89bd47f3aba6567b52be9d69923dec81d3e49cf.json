{"ast":null,"code":"import { ref, reactive, onMounted, onUnmounted } from 'vue';\nimport { useStore } from 'vuex';\nimport { ElMessage } from 'element-plus';\nimport * as echarts from 'echarts';\nexport default {\n  __name: 'Analysis',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const store = useStore();\n    const filterForm = reactive({\n      platform: '',\n      dateRange: []\n    });\n    const sentimentChartRef = ref(null);\n    const platformChartRef = ref(null);\n    const trendChartRef = ref(null);\n    let sentimentChart = null;\n    let platformChart = null;\n    let trendChart = null;\n    const initCharts = () => {\n      sentimentChart = echarts.init(sentimentChartRef.value);\n      platformChart = echarts.init(platformChartRef.value);\n      trendChart = echarts.init(trendChartRef.value);\n    };\n    const updateCharts = data => {\n      // 情感分布图表\n      sentimentChart.setOption({\n        title: {\n          text: '情感分布',\n          left: 'center'\n        },\n        tooltip: {\n          trigger: 'item',\n          formatter: '{a} <br/>{b}: {c} ({d}%)'\n        },\n        legend: {\n          orient: 'vertical',\n          left: 'left',\n          data: ['正面', '中性', '负面']\n        },\n        series: [{\n          name: '情感分布',\n          type: 'pie',\n          radius: '50%',\n          data: data.sentimentDistribution,\n          emphasis: {\n            itemStyle: {\n              shadowBlur: 10,\n              shadowOffsetX: 0,\n              shadowColor: 'rgba(0, 0, 0, 0.5)'\n            }\n          }\n        }]\n      });\n\n      // 平台分布图表\n      platformChart.setOption({\n        title: {\n          text: '平台分布',\n          left: 'center'\n        },\n        tooltip: {\n          trigger: 'item',\n          formatter: '{a} <br/>{b}: {c} ({d}%)'\n        },\n        legend: {\n          orient: 'vertical',\n          left: 'left',\n          data: ['微博', '微信', '知乎', 'B站']\n        },\n        series: [{\n          name: '平台分布',\n          type: 'pie',\n          radius: '50%',\n          data: data.platformDistribution,\n          emphasis: {\n            itemStyle: {\n              shadowBlur: 10,\n              shadowOffsetX: 0,\n              shadowColor: 'rgba(0, 0, 0, 0.5)'\n            }\n          }\n        }]\n      });\n\n      // 舆情趋势图表\n      trendChart.setOption({\n        title: {\n          text: '舆情趋势',\n          left: 'center'\n        },\n        tooltip: {\n          trigger: 'axis'\n        },\n        legend: {\n          data: ['正面', '中性', '负面'],\n          top: '30px'\n        },\n        xAxis: {\n          type: 'category',\n          data: data.trendData.dates\n        },\n        yAxis: {\n          type: 'value'\n        },\n        series: [{\n          name: '正面',\n          type: 'line',\n          data: data.trendData.positive\n        }, {\n          name: '中性',\n          type: 'line',\n          data: data.trendData.neutral\n        }, {\n          name: '负面',\n          type: 'line',\n          data: data.trendData.negative\n        }]\n      });\n    };\n    const handleFilter = () => {\n      const params = {\n        platform: filterForm.platform,\n        startDate: filterForm.dateRange?.[0],\n        endDate: filterForm.dateRange?.[1]\n      };\n      store.dispatch('opinion/getOpinionAnalysis', params).then(data => {\n        updateCharts(data);\n      }).catch(error => {\n        ElMessage.error(error.message || '获取分析数据失败');\n      });\n    };\n    const resetForm = () => {\n      Object.keys(filterForm).forEach(key => {\n        filterForm[key] = key === 'dateRange' ? [] : '';\n      });\n      handleFilter();\n    };\n    const handleResize = () => {\n      sentimentChart?.resize();\n      platformChart?.resize();\n      trendChart?.resize();\n    };\n    onMounted(() => {\n      initCharts();\n      handleFilter();\n      window.addEventListener('resize', handleResize);\n    });\n    onUnmounted(() => {\n      window.removeEventListener('resize', handleResize);\n      sentimentChart?.dispose();\n      platformChart?.dispose();\n      trendChart?.dispose();\n    });\n    const __returned__ = {\n      store,\n      filterForm,\n      sentimentChartRef,\n      platformChartRef,\n      trendChartRef,\n      get sentimentChart() {\n        return sentimentChart;\n      },\n      set sentimentChart(v) {\n        sentimentChart = v;\n      },\n      get platformChart() {\n        return platformChart;\n      },\n      set platformChart(v) {\n        platformChart = v;\n      },\n      get trendChart() {\n        return trendChart;\n      },\n      set trendChart(v) {\n        trendChart = v;\n      },\n      initCharts,\n      updateCharts,\n      handleFilter,\n      resetForm,\n      handleResize,\n      ref,\n      reactive,\n      onMounted,\n      onUnmounted,\n      get useStore() {\n        return useStore;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get echarts() {\n        return echarts;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","reactive","onMounted","onUnmounted","useStore","ElMessage","echarts","store","filterForm","platform","dateRange","sentimentChartRef","platformChartRef","trendChartRef","sentimentChart","platformChart","trendChart","initCharts","init","value","updateCharts","data","setOption","title","text","left","tooltip","trigger","formatter","legend","orient","series","name","type","radius","sentimentDistribution","emphasis","itemStyle","shadowBlur","shadowOffsetX","shadowColor","platformDistribution","top","xAxis","trendData","dates","yAxis","positive","neutral","negative","handleFilter","params","startDate","endDate","dispatch","then","catch","error","message","resetForm","Object","keys","forEach","key","handleResize","resize","window","addEventListener","removeEventListener","dispose"],"sources":["D:/a课程/软件工程/OpinionAnalysis/src/views/Analysis.vue"],"sourcesContent":["<template>\r\n  <div class=\"analysis-container\">\r\n    <el-row :gutter=\"20\">\r\n      <el-col :span=\"24\">\r\n        <el-card class=\"filter-card\">\r\n          <el-form :model=\"filterForm\" label-width=\"100px\">\r\n            <el-row :gutter=\"20\">\r\n              <el-col :span=\"8\">\r\n                <el-form-item label=\"平台来源\">\r\n                  <el-select\r\n                    v-model=\"filterForm.platform\"\r\n                    placeholder=\"请选择平台\"\r\n                    clearable\r\n                  >\r\n                    <el-option label=\"全部\" value=\"\" />\r\n                    <el-option label=\"微博\" value=\"weibo\" />\r\n                    <el-option label=\"微信\" value=\"wechat\" />\r\n                    <el-option label=\"知乎\" value=\"zhihu\" />\r\n                    <el-option label=\"B站\" value=\"bilibili\" />\r\n                  </el-select>\r\n                </el-form-item>\r\n              </el-col>\r\n              <el-col :span=\"16\">\r\n                <el-form-item label=\"时间范围\">\r\n                  <el-date-picker\r\n                    v-model=\"filterForm.dateRange\"\r\n                    type=\"daterange\"\r\n                    range-separator=\"至\"\r\n                    start-placeholder=\"开始日期\"\r\n                    end-placeholder=\"结束日期\"\r\n                    value-format=\"YYYY-MM-DD\"\r\n                  />\r\n                </el-form-item>\r\n              </el-col>\r\n            </el-row>\r\n            <el-form-item>\r\n              <el-button type=\"primary\" @click=\"handleFilter\">分析</el-button>\r\n              <el-button @click=\"resetForm\">重置</el-button>\r\n            </el-form-item>\r\n          </el-form>\r\n        </el-card>\r\n      </el-col>\r\n    </el-row>\r\n\r\n    <el-row :gutter=\"20\" class=\"chart-row\">\r\n      <el-col :span=\"12\">\r\n        <el-card class=\"chart-card\">\r\n          <template #header>\r\n            <div class=\"card-header\">\r\n              <span>情感分布</span>\r\n            </div>\r\n          </template>\r\n          <div ref=\"sentimentChartRef\" class=\"chart\"></div>\r\n        </el-card>\r\n      </el-col>\r\n      <el-col :span=\"12\">\r\n        <el-card class=\"chart-card\">\r\n          <template #header>\r\n            <div class=\"card-header\">\r\n              <span>平台分布</span>\r\n            </div>\r\n          </template>\r\n          <div ref=\"platformChartRef\" class=\"chart\"></div>\r\n        </el-card>\r\n      </el-col>\r\n    </el-row>\r\n\r\n    <el-row :gutter=\"20\" class=\"chart-row\">\r\n      <el-col :span=\"24\">\r\n        <el-card class=\"chart-card\">\r\n          <template #header>\r\n            <div class=\"card-header\">\r\n              <span>舆情趋势</span>\r\n            </div>\r\n          </template>\r\n          <div ref=\"trendChartRef\" class=\"chart\"></div>\r\n        </el-card>\r\n      </el-col>\r\n    </el-row>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, onMounted, onUnmounted } from 'vue'\r\nimport { useStore } from 'vuex'\r\nimport { ElMessage } from 'element-plus'\r\nimport * as echarts from 'echarts'\r\n\r\nconst store = useStore()\r\n\r\nconst filterForm = reactive({\r\n  platform: '',\r\n  dateRange: []\r\n})\r\n\r\nconst sentimentChartRef = ref(null)\r\nconst platformChartRef = ref(null)\r\nconst trendChartRef = ref(null)\r\nlet sentimentChart = null\r\nlet platformChart = null\r\nlet trendChart = null\r\n\r\nconst initCharts = () => {\r\n  sentimentChart = echarts.init(sentimentChartRef.value)\r\n  platformChart = echarts.init(platformChartRef.value)\r\n  trendChart = echarts.init(trendChartRef.value)\r\n}\r\n\r\nconst updateCharts = data => {\r\n  // 情感分布图表\r\n  sentimentChart.setOption({\r\n    title: {\r\n      text: '情感分布',\r\n      left: 'center'\r\n    },\r\n    tooltip: {\r\n      trigger: 'item',\r\n      formatter: '{a} <br/>{b}: {c} ({d}%)'\r\n    },\r\n    legend: {\r\n      orient: 'vertical',\r\n      left: 'left',\r\n      data: ['正面', '中性', '负面']\r\n    },\r\n    series: [\r\n      {\r\n        name: '情感分布',\r\n        type: 'pie',\r\n        radius: '50%',\r\n        data: data.sentimentDistribution,\r\n        emphasis: {\r\n          itemStyle: {\r\n            shadowBlur: 10,\r\n            shadowOffsetX: 0,\r\n            shadowColor: 'rgba(0, 0, 0, 0.5)'\r\n          }\r\n        }\r\n      }\r\n    ]\r\n  })\r\n\r\n  // 平台分布图表\r\n  platformChart.setOption({\r\n    title: {\r\n      text: '平台分布',\r\n      left: 'center'\r\n    },\r\n    tooltip: {\r\n      trigger: 'item',\r\n      formatter: '{a} <br/>{b}: {c} ({d}%)'\r\n    },\r\n    legend: {\r\n      orient: 'vertical',\r\n      left: 'left',\r\n      data: ['微博', '微信', '知乎', 'B站']\r\n    },\r\n    series: [\r\n      {\r\n        name: '平台分布',\r\n        type: 'pie',\r\n        radius: '50%',\r\n        data: data.platformDistribution,\r\n        emphasis: {\r\n          itemStyle: {\r\n            shadowBlur: 10,\r\n            shadowOffsetX: 0,\r\n            shadowColor: 'rgba(0, 0, 0, 0.5)'\r\n          }\r\n        }\r\n      }\r\n    ]\r\n  })\r\n\r\n  // 舆情趋势图表\r\n  trendChart.setOption({\r\n    title: {\r\n      text: '舆情趋势',\r\n      left: 'center'\r\n    },\r\n    tooltip: {\r\n      trigger: 'axis'\r\n    },\r\n    legend: {\r\n      data: ['正面', '中性', '负面'],\r\n      top: '30px'\r\n    },\r\n    xAxis: {\r\n      type: 'category',\r\n      data: data.trendData.dates\r\n    },\r\n    yAxis: {\r\n      type: 'value'\r\n    },\r\n    series: [\r\n      {\r\n        name: '正面',\r\n        type: 'line',\r\n        data: data.trendData.positive\r\n      },\r\n      {\r\n        name: '中性',\r\n        type: 'line',\r\n        data: data.trendData.neutral\r\n      },\r\n      {\r\n        name: '负面',\r\n        type: 'line',\r\n        data: data.trendData.negative\r\n      }\r\n    ]\r\n  })\r\n}\r\n\r\nconst handleFilter = () => {\r\n  const params = {\r\n    platform: filterForm.platform,\r\n    startDate: filterForm.dateRange?.[0],\r\n    endDate: filterForm.dateRange?.[1]\r\n  }\r\n\r\n  store\r\n    .dispatch('opinion/getOpinionAnalysis', params)\r\n    .then(data => {\r\n      updateCharts(data)\r\n    })\r\n    .catch(error => {\r\n      ElMessage.error(error.message || '获取分析数据失败')\r\n    })\r\n}\r\n\r\nconst resetForm = () => {\r\n  Object.keys(filterForm).forEach(key => {\r\n    filterForm[key] = key === 'dateRange' ? [] : ''\r\n  })\r\n  handleFilter()\r\n}\r\n\r\nconst handleResize = () => {\r\n  sentimentChart?.resize()\r\n  platformChart?.resize()\r\n  trendChart?.resize()\r\n}\r\n\r\nonMounted(() => {\r\n  initCharts()\r\n  handleFilter()\r\n  window.addEventListener('resize', handleResize)\r\n})\r\n\r\nonUnmounted(() => {\r\n  window.removeEventListener('resize', handleResize)\r\n  sentimentChart?.dispose()\r\n  platformChart?.dispose()\r\n  trendChart?.dispose()\r\n})\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.analysis-container {\r\n  .filter-card {\r\n    margin-bottom: 20px;\r\n  }\r\n\r\n  .chart-row {\r\n    margin-bottom: 20px;\r\n  }\r\n\r\n  .chart-card {\r\n    .chart {\r\n      height: 400px;\r\n    }\r\n  }\r\n}\r\n</style> "],"mappings":"AAmFA,SAASA,GAAG,EAAEC,QAAQ,EAAEC,SAAS,EAAEC,WAAW,QAAQ,KAAK;AAC3D,SAASC,QAAQ,QAAQ,MAAM;AAC/B,SAASC,SAAS,QAAQ,cAAc;AACxC,OAAO,KAAKC,OAAO,MAAM,SAAS;;;;;;;IAElC,MAAMC,KAAK,GAAGH,QAAQ,CAAC,CAAC;IAExB,MAAMI,UAAU,GAAGP,QAAQ,CAAC;MAC1BQ,QAAQ,EAAE,EAAE;MACZC,SAAS,EAAE;IACb,CAAC,CAAC;IAEF,MAAMC,iBAAiB,GAAGX,GAAG,CAAC,IAAI,CAAC;IACnC,MAAMY,gBAAgB,GAAGZ,GAAG,CAAC,IAAI,CAAC;IAClC,MAAMa,aAAa,GAAGb,GAAG,CAAC,IAAI,CAAC;IAC/B,IAAIc,cAAc,GAAG,IAAI;IACzB,IAAIC,aAAa,GAAG,IAAI;IACxB,IAAIC,UAAU,GAAG,IAAI;IAErB,MAAMC,UAAU,GAAGA,CAAA,KAAM;MACvBH,cAAc,GAAGR,OAAO,CAACY,IAAI,CAACP,iBAAiB,CAACQ,KAAK,CAAC;MACtDJ,aAAa,GAAGT,OAAO,CAACY,IAAI,CAACN,gBAAgB,CAACO,KAAK,CAAC;MACpDH,UAAU,GAAGV,OAAO,CAACY,IAAI,CAACL,aAAa,CAACM,KAAK,CAAC;IAChD,CAAC;IAED,MAAMC,YAAY,GAAGC,IAAI,IAAI;MAC3B;MACAP,cAAc,CAACQ,SAAS,CAAC;QACvBC,KAAK,EAAE;UACLC,IAAI,EAAE,MAAM;UACZC,IAAI,EAAE;QACR,CAAC;QACDC,OAAO,EAAE;UACPC,OAAO,EAAE,MAAM;UACfC,SAAS,EAAE;QACb,CAAC;QACDC,MAAM,EAAE;UACNC,MAAM,EAAE,UAAU;UAClBL,IAAI,EAAE,MAAM;UACZJ,IAAI,EAAE,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI;QACzB,CAAC;QACDU,MAAM,EAAE,CACN;UACEC,IAAI,EAAE,MAAM;UACZC,IAAI,EAAE,KAAK;UACXC,MAAM,EAAE,KAAK;UACbb,IAAI,EAAEA,IAAI,CAACc,qBAAqB;UAChCC,QAAQ,EAAE;YACRC,SAAS,EAAE;cACTC,UAAU,EAAE,EAAE;cACdC,aAAa,EAAE,CAAC;cAChBC,WAAW,EAAE;YACf;UACF;QACF,CAAC;MAEL,CAAC,CAAC;;MAEF;MACAzB,aAAa,CAACO,SAAS,CAAC;QACtBC,KAAK,EAAE;UACLC,IAAI,EAAE,MAAM;UACZC,IAAI,EAAE;QACR,CAAC;QACDC,OAAO,EAAE;UACPC,OAAO,EAAE,MAAM;UACfC,SAAS,EAAE;QACb,CAAC;QACDC,MAAM,EAAE;UACNC,MAAM,EAAE,UAAU;UAClBL,IAAI,EAAE,MAAM;UACZJ,IAAI,EAAE,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI;QAC/B,CAAC;QACDU,MAAM,EAAE,CACN;UACEC,IAAI,EAAE,MAAM;UACZC,IAAI,EAAE,KAAK;UACXC,MAAM,EAAE,KAAK;UACbb,IAAI,EAAEA,IAAI,CAACoB,oBAAoB;UAC/BL,QAAQ,EAAE;YACRC,SAAS,EAAE;cACTC,UAAU,EAAE,EAAE;cACdC,aAAa,EAAE,CAAC;cAChBC,WAAW,EAAE;YACf;UACF;QACF,CAAC;MAEL,CAAC,CAAC;;MAEF;MACAxB,UAAU,CAACM,SAAS,CAAC;QACnBC,KAAK,EAAE;UACLC,IAAI,EAAE,MAAM;UACZC,IAAI,EAAE;QACR,CAAC;QACDC,OAAO,EAAE;UACPC,OAAO,EAAE;QACX,CAAC;QACDE,MAAM,EAAE;UACNR,IAAI,EAAE,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC;UACxBqB,GAAG,EAAE;QACP,CAAC;QACDC,KAAK,EAAE;UACLV,IAAI,EAAE,UAAU;UAChBZ,IAAI,EAAEA,IAAI,CAACuB,SAAS,CAACC;QACvB,CAAC;QACDC,KAAK,EAAE;UACLb,IAAI,EAAE;QACR,CAAC;QACDF,MAAM,EAAE,CACN;UACEC,IAAI,EAAE,IAAI;UACVC,IAAI,EAAE,MAAM;UACZZ,IAAI,EAAEA,IAAI,CAACuB,SAAS,CAACG;QACvB,CAAC,EACD;UACEf,IAAI,EAAE,IAAI;UACVC,IAAI,EAAE,MAAM;UACZZ,IAAI,EAAEA,IAAI,CAACuB,SAAS,CAACI;QACvB,CAAC,EACD;UACEhB,IAAI,EAAE,IAAI;UACVC,IAAI,EAAE,MAAM;UACZZ,IAAI,EAAEA,IAAI,CAACuB,SAAS,CAACK;QACvB,CAAC;MAEL,CAAC,CAAC;IACJ,CAAC;IAED,MAAMC,YAAY,GAAGA,CAAA,KAAM;MACzB,MAAMC,MAAM,GAAG;QACb1C,QAAQ,EAAED,UAAU,CAACC,QAAQ;QAC7B2C,SAAS,EAAE5C,UAAU,CAACE,SAAS,GAAG,CAAC,CAAC;QACpC2C,OAAO,EAAE7C,UAAU,CAACE,SAAS,GAAG,CAAC;MACnC,CAAC;MAEDH,KAAK,CACF+C,QAAQ,CAAC,4BAA4B,EAAEH,MAAM,CAAC,CAC9CI,IAAI,CAAClC,IAAI,IAAI;QACZD,YAAY,CAACC,IAAI,CAAC;MACpB,CAAC,CAAC,CACDmC,KAAK,CAACC,KAAK,IAAI;QACdpD,SAAS,CAACoD,KAAK,CAACA,KAAK,CAACC,OAAO,IAAI,UAAU,CAAC;MAC9C,CAAC,CAAC;IACN,CAAC;IAED,MAAMC,SAAS,GAAGA,CAAA,KAAM;MACtBC,MAAM,CAACC,IAAI,CAACrD,UAAU,CAAC,CAACsD,OAAO,CAACC,GAAG,IAAI;QACrCvD,UAAU,CAACuD,GAAG,CAAC,GAAGA,GAAG,KAAK,WAAW,GAAG,EAAE,GAAG,EAAE;MACjD,CAAC,CAAC;MACFb,YAAY,CAAC,CAAC;IAChB,CAAC;IAED,MAAMc,YAAY,GAAGA,CAAA,KAAM;MACzBlD,cAAc,EAAEmD,MAAM,CAAC,CAAC;MACxBlD,aAAa,EAAEkD,MAAM,CAAC,CAAC;MACvBjD,UAAU,EAAEiD,MAAM,CAAC,CAAC;IACtB,CAAC;IAED/D,SAAS,CAAC,MAAM;MACde,UAAU,CAAC,CAAC;MACZiC,YAAY,CAAC,CAAC;MACdgB,MAAM,CAACC,gBAAgB,CAAC,QAAQ,EAAEH,YAAY,CAAC;IACjD,CAAC,CAAC;IAEF7D,WAAW,CAAC,MAAM;MAChB+D,MAAM,CAACE,mBAAmB,CAAC,QAAQ,EAAEJ,YAAY,CAAC;MAClDlD,cAAc,EAAEuD,OAAO,CAAC,CAAC;MACzBtD,aAAa,EAAEsD,OAAO,CAAC,CAAC;MACxBrD,UAAU,EAAEqD,OAAO,CAAC,CAAC;IACvB,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}