{"ast":null,"code":"import { login, logout, getInfo } from '@/api/user';\nconst state = {\n  token: localStorage.getItem('token'),\n  username: localStorage.getItem('username'),\n  role: localStorage.getItem('userRole'),\n  avatar: localStorage.getItem('avatar')\n};\nconst mutations = {\n  SET_TOKEN: (state, token) => {\n    state.token = token;\n  },\n  SET_USERNAME: (state, username) => {\n    state.username = username;\n  },\n  SET_ROLE: (state, role) => {\n    state.role = role;\n  },\n  SET_AVATAR: (state, avatar) => {\n    state.avatar = avatar;\n  }\n};\nconst actions = {\n  // 用户登录\n  login({\n    commit\n  }, userInfo) {\n    const {\n      username,\n      password\n    } = userInfo;\n    return new Promise((resolve, reject) => {\n      login({\n        username: username.trim(),\n        password: password\n      }).then(response => {\n        const {\n          data\n        } = response;\n        commit('SET_TOKEN', data.token);\n        commit('SET_USERNAME', data.username);\n        commit('SET_ROLE', data.role);\n        commit('SET_AVATAR', data.avatar);\n        localStorage.setItem('token', data.token);\n        localStorage.setItem('username', data.username);\n        localStorage.setItem('userRole', data.role);\n        localStorage.setItem('avatar', data.avatar);\n        resolve();\n      }).catch(error => {\n        reject(error);\n      });\n    });\n  },\n  // 获取用户信息\n  getInfo({\n    commit,\n    state\n  }) {\n    return new Promise((resolve, reject) => {\n      getInfo(state.token).then(response => {\n        const {\n          data\n        } = response;\n        if (!data) {\n          reject('验证失败，请重新登录');\n        }\n        const {\n          username,\n          role,\n          avatar\n        } = data;\n        commit('SET_USERNAME', username);\n        commit('SET_ROLE', role);\n        commit('SET_AVATAR', avatar);\n        resolve(data);\n      }).catch(error => {\n        reject(error);\n      });\n    });\n  },\n  // 用户登出\n  logout({\n    commit\n  }) {\n    return new Promise((resolve, reject) => {\n      logout().then(() => {\n        commit('SET_TOKEN', '');\n        commit('SET_USERNAME', '');\n        commit('SET_ROLE', '');\n        commit('SET_AVATAR', '');\n        localStorage.removeItem('token');\n        localStorage.removeItem('username');\n        localStorage.removeItem('userRole');\n        localStorage.removeItem('avatar');\n        resolve();\n      }).catch(error => {\n        reject(error);\n      });\n    });\n  }\n};\nexport default {\n  namespaced: true,\n  state,\n  mutations,\n  actions\n};","map":{"version":3,"names":["login","logout","getInfo","state","token","localStorage","getItem","username","role","avatar","mutations","SET_TOKEN","SET_USERNAME","SET_ROLE","SET_AVATAR","actions","commit","userInfo","password","Promise","resolve","reject","trim","then","response","data","setItem","catch","error","removeItem","namespaced"],"sources":["D:/a课程/软件工程/OpinionAnalysis/src/store/modules/user.js"],"sourcesContent":["import { login, logout, getInfo } from '@/api/user'\r\n\r\nconst state = {\r\n  token: localStorage.getItem('token'),\r\n  username: localStorage.getItem('username'),\r\n  role: localStorage.getItem('userRole'),\r\n  avatar: localStorage.getItem('avatar')\r\n}\r\n\r\nconst mutations = {\r\n  SET_TOKEN: (state, token) => {\r\n    state.token = token\r\n  },\r\n  SET_USERNAME: (state, username) => {\r\n    state.username = username\r\n  },\r\n  SET_ROLE: (state, role) => {\r\n    state.role = role\r\n  },\r\n  SET_AVATAR: (state, avatar) => {\r\n    state.avatar = avatar\r\n  }\r\n}\r\n\r\nconst actions = {\r\n  // 用户登录\r\n  login({ commit }, userInfo) {\r\n    const { username, password } = userInfo\r\n    return new Promise((resolve, reject) => {\r\n      login({ username: username.trim(), password: password })\r\n        .then(response => {\r\n          const { data } = response\r\n          commit('SET_TOKEN', data.token)\r\n          commit('SET_USERNAME', data.username)\r\n          commit('SET_ROLE', data.role)\r\n          commit('SET_AVATAR', data.avatar)\r\n          \r\n          localStorage.setItem('token', data.token)\r\n          localStorage.setItem('username', data.username)\r\n          localStorage.setItem('userRole', data.role)\r\n          localStorage.setItem('avatar', data.avatar)\r\n          \r\n          resolve()\r\n        })\r\n        .catch(error => {\r\n          reject(error)\r\n        })\r\n    })\r\n  },\r\n\r\n  // 获取用户信息\r\n  getInfo({ commit, state }) {\r\n    return new Promise((resolve, reject) => {\r\n      getInfo(state.token)\r\n        .then(response => {\r\n          const { data } = response\r\n          if (!data) {\r\n            reject('验证失败，请重新登录')\r\n          }\r\n          \r\n          const { username, role, avatar } = data\r\n          commit('SET_USERNAME', username)\r\n          commit('SET_ROLE', role)\r\n          commit('SET_AVATAR', avatar)\r\n          \r\n          resolve(data)\r\n        })\r\n        .catch(error => {\r\n          reject(error)\r\n        })\r\n    })\r\n  },\r\n\r\n  // 用户登出\r\n  logout({ commit }) {\r\n    return new Promise((resolve, reject) => {\r\n      logout()\r\n        .then(() => {\r\n          commit('SET_TOKEN', '')\r\n          commit('SET_USERNAME', '')\r\n          commit('SET_ROLE', '')\r\n          commit('SET_AVATAR', '')\r\n          \r\n          localStorage.removeItem('token')\r\n          localStorage.removeItem('username')\r\n          localStorage.removeItem('userRole')\r\n          localStorage.removeItem('avatar')\r\n          \r\n          resolve()\r\n        })\r\n        .catch(error => {\r\n          reject(error)\r\n        })\r\n    })\r\n  }\r\n}\r\n\r\nexport default {\r\n  namespaced: true,\r\n  state,\r\n  mutations,\r\n  actions\r\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}